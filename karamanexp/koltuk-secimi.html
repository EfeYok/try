<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karaman Express - Koltuk Se√ßimi</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-900 via-blue-600 to-blue-400">
    <!-- Header -->
    <div class="bg-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <button onclick="window.location.href='sefer-listesi.html'"
                    class="flex items-center gap-3 hover:opacity-80 transition">
                    <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    <h1 class="text-2xl font-bold text-gray-800">Karaman Express</h1>
                </button>
                <div class="text-sm text-gray-600">
                    üìû 0555 555 55 55
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Steps -->
    <div class="bg-white/10 backdrop-blur-sm border-b border-white/20">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-center gap-2">
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center font-bold text-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <span class="text-white text-sm font-medium hidden sm:inline">G√ºzergah</span>
                </div>
                <div class="w-12 h-1 bg-green-500"></div>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center font-bold text-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <span class="text-white text-sm font-medium hidden sm:inline">Sefer</span>
                </div>
                <div class="w-12 h-1 bg-blue-400"></div>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-blue-400 text-white flex items-center justify-center font-bold text-sm">
                        3</div>
                    <span class="text-white text-sm font-medium hidden sm:inline">Koltuk</span>
                </div>
                <div class="w-12 h-1 bg-gray-400"></div>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-gray-400 text-white flex items-center justify-center font-bold text-sm">
                        4</div>
                    <span class="text-white text-sm font-medium hidden sm:inline">Bilgiler</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Sefer √ñzeti -->
        <div class="max-w-6xl mx-auto mb-6">
            <div class="bg-white rounded-xl shadow-lg p-4">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <div class="text-lg font-bold text-gray-800" id="route-summary"></div>
                        <span class="text-gray-400">‚Ä¢</span>
                        <div class="text-gray-600 font-medium" id="date-summary"></div>
                        <span class="text-gray-400">‚Ä¢</span>
                        <div class="text-blue-600 font-bold" id="time-summary"></div>
                    </div>
                    <button onclick="window.location.href='sefer-listesi.html'"
                        class="text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Deƒüi≈ütir
                    </button>
                </div>
            </div>
        </div>

        <div class="max-w-6xl mx-auto grid lg:grid-cols-3 gap-6">
            <!-- Sol Panel: Otob√ºs D√ºzeni -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Koltuk Se√ßimi</h2>
                        <div id="bus-type-badge" class="px-4 py-2 rounded-full font-bold text-sm"></div>
                    </div>

                    <!-- ≈ûof√∂r B√∂l√ºm√º -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-gray-700 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path
                                            d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                                    </svg>
                                </div>
                                <span class="font-bold text-gray-700">≈ûOF√ñR</span>
                            </div>
                            <div class="text-sm text-gray-600">
                                <span class="font-semibold" id="selected-count">0</span> / <span
                                    id="total-seats"></span> koltuk
                            </div>
                        </div>
                    </div>

                    <!-- Koltuklar -->
                    <div id="seats-container" class="space-y-3 mb-6">
                        <!-- JavaScript ile doldurulacak -->
                    </div>

                    <!-- Lejant -->
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 pt-6 border-t border-gray-200">
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-12 bg-green-500 rounded-lg"></div>
                            <span class="text-sm text-gray-700 font-medium">Bo≈ü</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-12 bg-blue-600 rounded-lg"></div>
                            <span class="text-sm text-gray-700 font-medium">Se√ßili</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-12 bg-gray-400 rounded-lg"></div>
                            <span class="text-sm text-gray-700 font-medium">Dolu</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-12 bg-pink-500 rounded-lg"></div>
                            <span class="text-sm text-gray-700 font-medium">Kadƒ±n</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Saƒü Panel: Cinsiyet ve √ñzet -->
            <div class="space-y-6">
                <!-- Cinsiyet Se√ßimi -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Yolcu Bilgileri</h3>
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                        <p class="text-sm text-blue-800 font-semibold">
                            üìã <span id="passenger-count-text"></span>
                        </p>
                        <p class="text-xs text-blue-600 mt-1">
                            Her koltuk i√ßin ayrƒ± cinsiyet se√ßimi yapabilirsiniz
                        </p>
                    </div>

                    <div id="gender-selection-area">
                        <!-- Se√ßilen her koltuk i√ßin cinsiyet se√ßimi buraya eklenecek -->
                    </div>

                    <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                        <p class="text-xs text-blue-800 flex items-start gap-2">
                            <svg class="w-4 h-4 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Kadƒ±n yolcularƒ±n yanƒ±ndaki koltuk erkek yolcular tarafƒ±ndan se√ßilemez.</span>
                        </p>
                    </div>
                </div>

                <!-- Rezervasyon √ñzeti -->
                <div id="summary-card"
                    class="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl shadow-lg p-6 text-white hidden">
                    <h3 class="text-xl font-bold mb-4">Rezervasyon √ñzeti</h3>
                    <div class="space-y-3 mb-6">
                        <div class="pb-3 border-b border-white/30">
                            <span class="text-blue-100">Se√ßilen Koltuklar:</span>
                            <div class="font-bold text-2xl mt-1" id="selected-seats-list"></div>
                        </div>
                        <div class="pb-3 border-b border-white/30">
                            <span class="text-blue-100">Yolcu Sayƒ±sƒ±:</span>
                            <span class="font-bold text-xl ml-2" id="passenger-count-display"></span>
                        </div>
                        <div class="pb-3 border-b border-white/30">
                            <span class="text-blue-100">Bilet Fiyatƒ±:</span>
                            <span class="font-bold text-xl ml-2" id="ticket-price"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-100 font-semibold">Toplam:</span>
                            <span class="font-bold text-3xl" id="total-price"></span>
                        </div>
                    </div>
                    <button onclick="continueToPayment()"
                        class="w-full bg-white text-blue-600 py-4 rounded-lg font-bold text-lg hover:bg-blue-50 transition-all shadow-lg transform hover:scale-105">
                        Devam Et ‚Üí
                    </button>
                </div>

                <!-- Uyarƒ± Kartƒ± -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                        √ñnemli Bilgiler
                    </h3>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li class="flex items-start gap-2">
                            <svg class="w-4 h-4 mt-0.5 text-blue-600 flex-shrink-0" fill="currentColor"
                                viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Se√ßtiƒüiniz koltuk 15 dakika s√ºreyle sizin i√ßin rezerve edilecektir.</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <svg class="w-4 h-4 mt-0.5 text-blue-600 flex-shrink-0" fill="currentColor"
                                viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Koltuk deƒüi≈üikliƒüi i√ßin bir sonraki adƒ±mda geri d√∂nebilirsiniz.</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <svg class="w-4 h-4 mt-0.5 text-blue-600 flex-shrink-0" fill="currentColor"
                                viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Yanƒ±nƒ±zdaki koltuƒüu ba≈üka bir yolcu se√ßebilir.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyD7hCepYSGIR9WPbTQQ9UhivBQr9IxQFfc",
            authDomain: "karaman-express.firebaseapp.com",
            projectId: "karaman-express",
            storageBucket: "karaman-express.firebasestorage.app",
            messagingSenderId: "675458442911",
            appId: "1:675458442911:web:ca7d007b71649d0da864aa"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.firestoreModules = { collection, query, where, getDocs };
    </script>

    <script>
        const tripData = JSON.parse(localStorage.getItem('selectedTrip'));
        const searchData = JSON.parse(localStorage.getItem('searchData'));

        let selectedSeats = []; // Birden fazla koltuk se√ßilebilir
        let passengerGenders = {}; // Her koltuk i√ßin cinsiyet
        let occupiedSeats = []; // Firebase'den gelecek
        let femaleSeats = []; // Firebase'den gelecek

        const passengerCount = parseInt(searchData.passengerCount) || 1;

        if (!tripData || !searchData) {
            window.location.href = 'index.html';
        }

        // Sayfa bilgilerini doldur
        document.getElementById('route-summary').textContent = `${tripData.from} ‚Üí ${tripData.to}`;
        document.getElementById('date-summary').textContent = tripData.date.formatted.split(',')[0];
        document.getElementById('time-summary').textContent = tripData.time;

        const busTypeBadge = document.getElementById('bus-type-badge');
        busTypeBadge.textContent = tripData.busType;
        busTypeBadge.className = `px-4 py-2 rounded-full font-bold text-sm ${tripData.busType === 'VIP' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'
            }`;

        // Koltuk d√ºzeni
        const isVIP = tripData.busType === 'VIP';
        const rows = isVIP ? 10 : 13;
        const layout = isVIP ? [2, 1] : [2, 2];
        const totalSeats = rows * (layout[0] + layout[1]);

        document.getElementById('total-seats').textContent = totalSeats;

        // Yolcu sayƒ±sƒ±nƒ± g√∂ster
        document.getElementById('passenger-count-text').textContent = passengerCount + ' yolcu i√ßin koltuk se√ßimi yapƒ±lacak';

        // SADECE Firebase'den ger√ßek dolu koltuklarƒ± y√ºkle
        loadOccupiedSeats();

        async function loadOccupiedSeats() {
            console.log('üîç Firebase baƒülantƒ±sƒ± kontrol ediliyor...');

            // Firebase y√ºklenene kadar bekle
            let attempts = 0;
            while (!window.firestoreModules && attempts < 20) {
                console.log('‚è≥ Firebase y√ºkleniyor... (' + (attempts + 1) + '/20)');
                await new Promise(resolve => setTimeout(resolve, 300));
                attempts++;
            }

            if (!window.firestoreModules) {
                console.error('‚ùå Firebase mod√ºlleri y√ºklenemedi!');
                console.log('üí° √á√∂z√ºm: Firebase config ayarlarƒ±nƒ±zƒ± kontrol edin');

                // Firebase olmadan devam et - t√ºm koltuklar bo≈ü
                occupiedSeats = [];
                femaleSeats = [];
                renderSeats();
                return;
            }

            if (!window.db) {
                console.error('‚ùå Firebase database baƒülantƒ±sƒ± yok!');
                occupiedSeats = [];
                femaleSeats = [];
                renderSeats();
                return;
            }

            const { collection, query, where, getDocs } = window.firestoreModules;

            try {
                console.log('‚úÖ Firebase baƒülantƒ±sƒ± ba≈üarƒ±lƒ±!');
                console.log('üìä Sefer bilgileri:', {
                    from: tripData.from,
                    to: tripData.to,
                    date: tripData.date.date,
                    time: tripData.time,
                    busType: tripData.busType
                });

                const reservationsRef = collection(window.db, 'reservations');
                const q = query(
                    reservationsRef,
                    where('from', '==', tripData.from),
                    where('to', '==', tripData.to),
                    where('date', '==', tripData.date.date),
                    where('time', '==', tripData.time),
                    where('busType', '==', tripData.busType)
                );

                console.log('üîé Firestore sorgusu √ßalƒ±≈ütƒ±rƒ±lƒ±yor...');
                const querySnapshot = await getDocs(q);

                // Temiz listeler
                occupiedSeats = [];
                femaleSeats = [];

                if (querySnapshot.empty) {
                    console.log('‚úÖ Bu sefer i√ßin rezervasyon yok - T√ºm koltuklar bo≈ü');
                } else {
                    console.log('‚úÖ ' + querySnapshot.size + ' rezervasyon bulundu:');

                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        console.log('  üìå Koltuk ' + data.seatNumber + ' - ' + data.fullname + ' (' + data.gender + ')');

                        occupiedSeats.push(data.seatNumber);

                        if (data.gender === 'Kadƒ±n') {
                            femaleSeats.push(data.seatNumber);
                        }
                    });
                }

                console.log('üìã Dolu koltuklar:', occupiedSeats.length > 0 ? occupiedSeats : 'Yok');
                console.log('üë© Kadƒ±n yolcu koltuklarƒ±:', femaleSeats.length > 0 ? femaleSeats : 'Yok');

                // Koltuklarƒ± olu≈ütur
                renderSeats();

            } catch (error) {
                console.error('‚ùå Firebase sorgu hatasƒ±:', error);
                console.error('Hata detayƒ±:', error.code, error.message);

                if (error.code === 'failed-precondition') {
                    console.error('üí° Firestore Database hen√ºz olu≈üturulmamƒ±≈ü. Firebase Console\'dan olu≈üturun.');
                } else if (error.code === 'permission-denied') {
                    console.error('üí° Firestore kurallarƒ± eri≈üimi engelliyor. Test mode\'a ge√ßin.');
                }

                // Hata olsa da devam et - t√ºm koltuklar bo≈ü
                occupiedSeats = [];
                femaleSeats = [];
                renderSeats();
            }
        }

        function renderSeats() {
            const seatsContainer = document.getElementById('seats-container');
            seatsContainer.innerHTML = '';

            let seatNumber = 0;

            for (let row = 0; row < rows; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'flex items-center justify-center gap-3';

                // Sol koltuklar
                for (let i = 0; i < layout[0]; i++) {
                    seatNumber++;
                    rowDiv.appendChild(createSeat(seatNumber));
                }

                // Koridor
                const corridor = document.createElement('div');
                corridor.className = 'w-8 flex items-center justify-center';
                corridor.innerHTML = '<div class="w-0.5 h-12 bg-gray-300"></div>';
                rowDiv.appendChild(corridor);

                // Saƒü koltuklar
                for (let i = 0; i < layout[1]; i++) {
                    seatNumber++;
                    rowDiv.appendChild(createSeat(seatNumber));
                }

                seatsContainer.appendChild(rowDiv);
            }
        }

        function createSeat(num) {
            const isOccupied = occupiedSeats.includes(num);
            const isFemale = femaleSeats.includes(num);
            const isSelected = selectedSeats.includes(num);

            const seatButton = document.createElement('button');
            seatButton.type = 'button';

            let className = 'w-12 h-14 rounded-lg font-bold text-sm transition-all transform hover:scale-110 ';

            if (isOccupied) {
                className += 'bg-gray-400 cursor-not-allowed text-white';
            } else if (isSelected) {
                className += 'bg-blue-600 text-white shadow-xl scale-110';
            } else if (isFemale) {
                className += 'bg-pink-500 hover:bg-pink-600 text-white shadow-md';
            } else {
                className += 'bg-green-500 hover:bg-green-600 text-white shadow-md';
            }

            seatButton.className = className;
            seatButton.textContent = num;
            seatButton.disabled = isOccupied;
            seatButton.dataset.seatId = num;
            seatButton.dataset.isFemale = isFemale;

            if (!isOccupied) {
                seatButton.onclick = () => toggleSeat(num, isFemale);
            }

            return seatButton;
        }

        function toggleSeat(seatId, isFemale) {
            // Koltuk zaten se√ßili mi?
            const seatIndex = selectedSeats.indexOf(seatId);

            if (seatIndex > -1) {
                // Koltuk se√ßimini kaldƒ±r
                selectedSeats.splice(seatIndex, 1);
                delete passengerGenders[seatId];
            } else {
                // Maksimum koltuk kontrol√º
                if (selectedSeats.length >= passengerCount) {
                    alert(`‚ö†Ô∏è Maksimum ${passengerCount} koltuk se√ßebilirsiniz!`);
                    return;
                }

                // Koltuk se√ß
                selectedSeats.push(seatId);
                selectedSeats.sort((a, b) => a - b); // Sƒ±rala
            }

            renderSeats();
            updateGenderSelection();
            updateSummary();
        }

        function updateGenderSelection() {
            const genderArea = document.getElementById('gender-selection-area');
            genderArea.innerHTML = '';

            if (selectedSeats.length === 0) {
                genderArea.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">√ñnce koltuk se√ßiniz</p>';
                return;
            }

            selectedSeats.forEach(seatId => {
                const seatDiv = document.createElement('div');
                seatDiv.className = 'mb-4 p-4 bg-gray-50 rounded-lg';

                const currentGender = passengerGenders[seatId];
                const isFemale = femaleSeats.includes(seatId);

                seatDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-gray-800">Koltuk ${seatId}</span>
                        ${isFemale ? '<span class="text-xs bg-pink-100 text-pink-700 px-2 py-1 rounded">Kadƒ±n yolcu yanƒ±</span>' : ''}
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <button 
                            onclick="setGender(${seatId}, 'Erkek')" 
                            id="gender-male-${seatId}" 
                            class="p-3 rounded-lg border-2 transition-all text-center ${currentGender === 'Erkek'
                        ? 'border-blue-600 bg-blue-50'
                        : 'border-gray-300 hover:border-blue-600 hover:bg-blue-50'
                    } ${isFemale ? 'opacity-50 cursor-not-allowed' : ''}"
                            ${isFemale ? 'disabled' : ''}
                        >
                            <div class="text-2xl mb-1">üë®</div>
                            <div class="font-bold text-gray-800 text-sm">Erkek</div>
                        </button>
                        <button 
                            onclick="setGender(${seatId}, 'Kadƒ±n')" 
                            id="gender-female-${seatId}" 
                            class="p-3 rounded-lg border-2 transition-all text-center ${currentGender === 'Kadƒ±n'
                        ? 'border-pink-600 bg-pink-50'
                        : 'border-gray-300 hover:border-pink-600 hover:bg-pink-50'
                    }"
                        >
                            <div class="text-2xl mb-1">üë©</div>
                            <div class="font-bold text-gray-800 text-sm">Kadƒ±n</div>
                        </button>
                    </div>
                    ${isFemale ? '<p class="text-xs text-pink-600 mt-2">‚ö†Ô∏è Bu koltuk kadƒ±n yolcu yanƒ±ndadƒ±r</p>' : ''}
                `;

                genderArea.appendChild(seatDiv);
            });
        }

        function setGender(seatId, gender) {
            const isFemale = femaleSeats.includes(seatId);

            if (gender === 'Erkek' && isFemale) {
                alert('‚ö†Ô∏è Bu koltuk kadƒ±n yolcunun yanƒ±ndadƒ±r. Erkek yolcu se√ßemez.');
                return;
            }

            passengerGenders[seatId] = gender;
            updateGenderSelection();
            updateSummary();
        }

        function updateSummary() {
            const summaryCard = document.getElementById('summary-card');
            const selectedCountSpan = document.getElementById('selected-count');

            selectedCountSpan.textContent = selectedSeats.length;

            // T√ºm koltuklar se√ßildi ve cinsiyet belirlendi mi?
            const allGendersSelected = selectedSeats.every(seat => passengerGenders[seat]);
            const correctCount = selectedSeats.length === passengerCount;

            if (correctCount && allGendersSelected) {
                summaryCard.classList.remove('hidden');
                document.getElementById('selected-seats-list').textContent = selectedSeats.join(', ');
                document.getElementById('passenger-count-display').textContent = passengerCount + ' Yolcu';
                const totalPrice = tripData.price * passengerCount;
                document.getElementById('total-price').textContent = totalPrice + ' ‚Ç∫';
            } else {
                summaryCard.classList.add('hidden');
            }
        }

        function continueToPayment() {
            if (selectedSeats.length !== passengerCount) {
                alert(`‚ö†Ô∏è L√ºtfen ${passengerCount} koltuk se√ßiniz!`);
                return;
            }

            const allGendersSelected = selectedSeats.every(seat => passengerGenders[seat]);
            if (!allGendersSelected) {
                alert('‚ö†Ô∏è L√ºtfen t√ºm koltuklar i√ßin cinsiyet se√ßiniz!');
                return;
            }

            const seatData = {
                seats: selectedSeats.map(seatId => ({
                    seatNumber: seatId,
                    gender: passengerGenders[seatId]
                })),
                totalPassengers: passengerCount
            };

            localStorage.setItem('selectedSeatData', JSON.stringify(seatData));
            window.location.href = 'yolcu-bilgileri.html';
        }
    </script>
</body>

</html>